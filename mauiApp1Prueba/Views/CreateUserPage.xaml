<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="mauiApp1Prueba.Views.CreateUserPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:mauiApp1Prueba.ViewModels"
             x:DataType="viewmodels:CreateUserViewModel"
             Title="Crear Usuario"
             Background="{StaticResource CoolBackgroundGradient}">

    <ScrollView>
        <Grid Padding="24,20,24,40">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header Mejorado -->
            <Frame Grid.Row="0" 
                   BackgroundColor="Transparent"
                   BorderColor="Transparent"
                   Margin="0,10,0,20">
                <StackLayout Spacing="12">
                    <!-- Logo con background circular -->
                    <Frame BackgroundColor="{StaticResource Primary}"
                           WidthRequest="90"
                           HeightRequest="90"
                           CornerRadius="45"
                           HasShadow="True"
                           HorizontalOptions="Center">
                        <Frame.Shadow>
                            <Shadow Brush="{StaticResource PrimaryBrush}"
                                    Offset="0,6"
                                    Radius="15"
                                    Opacity="0.25"/>
                        </Frame.Shadow>
                        <Label Text="📻" 
                               FontSize="42" 
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               TextColor="White"/>
                    </Frame>

                    <Label Text="Radio Punta del Este" 
                           FontSize="28" 
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"
                           Margin="0,5,0,0"/>

                    <Label Text="Únete a nuestra comunidad" 
                           FontSize="18" 
                           FontAttributes="Italic"
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"/>

                    <Label Text="Completa tu registro para acceder a todos los servicios exclusivos" 
                           FontSize="14" 
                           TextColor="{StaticResource TextLight}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           Margin="20,5,20,0"/>
                </StackLayout>
            </Frame>

            <!-- Formulario Mejorado -->
            <StackLayout Grid.Row="1" Spacing="24">

                <!-- Foto de perfil con diseño mejorado -->
                <Frame BackgroundColor="{StaticResource SurfaceCard}"
                       BorderColor="Transparent"
                       CornerRadius="20"
                       Padding="24"
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,2"
                                Radius="8"
                                Opacity="0.1"/>
                    </Frame.Shadow>
                    <StackLayout Spacing="16">
                        <!-- Header de sección -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Frame Grid.Column="0" 
                                   BackgroundColor="{StaticResource Secondary}"
                                   WidthRequest="32"
                                   HeightRequest="32"
                                   CornerRadius="16"
                                   Padding="0">
                                <Label Text="📸" 
                                       FontSize="16" 
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       TextColor="White"/>
                            </Frame>

                            <StackLayout Grid.Column="1" 
                                       VerticalOptions="Center" 
                                       Margin="12,0,0,0">
                                <Label Text="Foto de Perfil" 
                                       FontSize="17" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label Text="Opcional" 
                                       FontSize="12" 
                                       TextColor="{StaticResource TextLight}"/>
                            </StackLayout>
                        </Grid>

                        <Button Text="{Binding ProfileImageDisplayText}"
                                Command="{Binding SelectPhotoCommand}"
                                BackgroundColor="{StaticResource Secondary}"
                                TextColor="{StaticResource TextOnPrimary}"
                                CornerRadius="30"
                                HeightRequest="56"
                                FontSize="16"
                                >
                            <Button.Shadow>
                                <Shadow Brush="{StaticResource Secondary}"
                                        Offset="0,3"
                                        Radius="8"
                                        Opacity="0.2"/>
                            </Button.Shadow>
                        </Button>

                        <Label Text="Toma una foto nueva o selecciona desde tu galería" 
                               FontSize="13" 
                               TextColor="{StaticResource TextLight}"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </StackLayout>
                </Frame>

                <!-- Información personal mejorada -->
                <Frame BackgroundColor="{StaticResource SurfaceCard}"
                       BorderColor="Transparent"
                       CornerRadius="20"
                       Padding="24"
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,2"
                                Radius="8"
                                Opacity="0.1"/>
                    </Frame.Shadow>
                    <StackLayout Spacing="20">
                        <!-- Header de sección -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Frame Grid.Column="0" 
                                   BackgroundColor="{StaticResource Primary}"
                                   WidthRequest="32"
                                   HeightRequest="32"
                                   CornerRadius="16"
                                   Padding="0">
                                <Label Text="👤" 
                                       FontSize="16" 
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       TextColor="White"/>
                            </Frame>

                            <StackLayout Grid.Column="1" 
                                       VerticalOptions="Center" 
                                       Margin="12,0,0,0">
                                <Label Text="Información Personal" 
                                       FontSize="17" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label Text="Datos básicos de tu perfil" 
                                       FontSize="12" 
                                       TextColor="{StaticResource TextLight}"/>
                            </StackLayout>
                        </Grid>

                        <!-- Campos de entrada con mejor diseño -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Nombre de usuario -->
                            <StackLayout Grid.Row="0" Spacing="10">
                                <Label Text="Nombre de usuario *" 
                                       FontSize="15" 
                                       
                                       TextColor="{StaticResource TextSecondary}"/>
                                <Frame BackgroundColor="{StaticResource Gray100}"
                                       BorderColor="Black"
                                       CornerRadius="12"
                                       Padding="0"
                                       HeightRequest="50">
                                    <Entry Text="{Binding Username}"
                                           Placeholder="Ej: juan123"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                           PlaceholderColor="Gray"
                                           FontSize="16"
                                           Margin="16,0"/>
                                </Frame>
                            </StackLayout>

                            <!-- Nombre completo -->
                            <StackLayout Grid.Row="1" Spacing="10" Margin="0,15,0,0">
                                <Label Text="Nombre completo *" 
                                       FontSize="15" 
                                       
                                       TextColor="{StaticResource TextSecondary}"/>
                                <Frame BackgroundColor="{StaticResource Gray100}"
                                       BorderColor="Transparent"
                                       CornerRadius="12"
                                       Padding="0"
                                       HeightRequest="50">
                                    <Entry Text="{Binding FullName}"
                                           Placeholder="Ej: Juan Pérez"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                            PlaceholderColor="Gray"
                                           FontSize="16"
                                           Margin="16,0"/>
                                </Frame>
                            </StackLayout>

                            <!-- Email -->
                            <StackLayout Grid.Row="2" Spacing="10" Margin="0,15,0,0">
                                <Label Text="Email *" 
                                       FontSize="15" 
                                       
                                       TextColor="{StaticResource TextSecondary}"/>
                                <Frame BackgroundColor="{StaticResource Gray100}"
                                       BorderColor="Transparent"
                                       CornerRadius="12"
                                       Padding="0"
                                       HeightRequest="50">
                                    <Entry Text="{Binding Email}"
                                           Placeholder="ejemplo@correo.com"
                                           Keyboard="Email"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                            PlaceholderColor="Gray"
                                           FontSize="16"
                                           Margin="16,0"/>
                                </Frame>
                            </StackLayout>

                            <!-- Teléfono y Dirección en una fila en tablets -->
                            <Grid Grid.Row="3" Margin="0,15,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackLayout Grid.Column="0" Spacing="10">
                                    <Label Text="Teléfono" 
                                           FontSize="15" 
                                           
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <Frame BackgroundColor="{StaticResource Gray100}"
                                           BorderColor="Transparent"
                                           CornerRadius="12"
                                           Padding="0"
                                           HeightRequest="50">
                                        <Entry Text="{Binding Phone}"
                                               Placeholder="099 123 456"
                                               Keyboard="Telephone"
                                               BackgroundColor="Transparent"
                                               TextColor="Black"
                                                PlaceholderColor="Gray"
                                               FontSize="16"
                                               Margin="16,0"/>
                                    </Frame>
                                </StackLayout>
                            </Grid>

                            <!-- Dirección -->
                            <StackLayout Grid.Row="4" Spacing="10" Margin="0,15,0,0">
                                <Label Text="Dirección" 
                                       FontSize="15" 
                                       
                                       TextColor="{StaticResource TextSecondary}"/>
                                <Frame BackgroundColor="{StaticResource Gray100}"
                                       BorderColor="Transparent"
                                       CornerRadius="12"
                                       Padding="0"
                                       HeightRequest="50">
                                    <Entry Text="{Binding Address}"
                                           Placeholder="Calle, número, ciudad"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                            PlaceholderColor="Gray" 
                                           FontSize="16"
                                           Margin="16,0"/>
                                </Frame>
                            </StackLayout>
                        </Grid>
                    </StackLayout>
                </Frame>

                <!-- Contraseñas con diseño mejorado -->
                <Frame BackgroundColor="{StaticResource SurfaceCard}"
                       BorderColor="Transparent"
                       CornerRadius="20"
                       Padding="24"
                       HasShadow="True">
                    <Frame.Shadow>
                        <Shadow Brush="Black"
                                Offset="0,2"
                                Radius="8"
                                Opacity="0.1"/>
                    </Frame.Shadow>
                    <StackLayout Spacing="20">
                        <!-- Header de sección -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Frame Grid.Column="0" 
                                   BackgroundColor="{StaticResource Primary}"
                                   WidthRequest="32"
                                   HeightRequest="32"
                                   CornerRadius="16"
                                   Padding="0">
                                <Label Text="🔒" 
                                       FontSize="16" 
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"
                                       TextColor="White"/>
                            </Frame>

                            <StackLayout Grid.Column="1" 
                                       VerticalOptions="Center" 
                                       Margin="12,0,0,0">
                                <Label Text="Seguridad" 
                                       FontSize="17" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource TextPrimary}"/>
                                <Label Text="Protege tu cuenta con una contraseña segura" 
                                       FontSize="12" 
                                       TextColor="{StaticResource TextLight}"/>
                            </StackLayout>
                        </Grid>

                        <!-- Contraseña -->
                        <StackLayout Spacing="10">
                            <Label Text="Contraseña *" 
                                   FontSize="15" 
                                   
                                   TextColor="{StaticResource TextSecondary}"/>
                            <Frame BackgroundColor="{StaticResource Gray100}"
                                   
                                   CornerRadius="12"
                                   Padding="0"
                                   HeightRequest="50">
                                <Grid>
                                    <Entry Text="{Binding Password}"
                                           Placeholder="Mínimo 6 caracteres"
                                           IsPassword="True"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
                                            PlaceholderColor="Gray"
                                           FontSize="16"
                                           Margin="16,0,45,0"/>
                                    <Button Text="👁️"
                                            Command="{Binding TogglePasswordVisibilityCommand}"
                                            BackgroundColor="Transparent"
                                            TextColor="{StaticResource TextLight}"
                                            HorizontalOptions="End"
                                            VerticalOptions="Center"
                                            Margin="0,0,8,0"
                                            FontSize="18"
                                            WidthRequest="40"/>
                                </Grid>
                            </Frame>
                        </StackLayout>

                        <!-- Confirmar contraseña -->
                        <StackLayout Spacing="10">
                            <Label Text="Confirmar contraseña *" 
                                   FontSize="15" 
                                   
                                   TextColor="{StaticResource TextSecondary}"/>
                            <Frame BackgroundColor="{StaticResource Gray100}"
                                   BorderColor="Transparent"
                                   CornerRadius="12"
                                   Padding="0"
                                   HeightRequest="50">
                                <Grid>
                                    <Entry Text="{Binding ConfirmPassword}"
                                           Placeholder="Repetir contraseña"
                                           IsPassword="True"
                                           BackgroundColor="Transparent"
                                           TextColor="Black"
 PlaceholderColor="Gray"
                                           FontSize="16"
                                           Margin="16,0,45,0"/>
                                    <Button Text="👁️"
                                            Command="{Binding ToggleConfirmPasswordVisibilityCommand}"
                                            BackgroundColor="Transparent"
                                            TextColor="{StaticResource TextLight}"
                                            HorizontalOptions="End"
                                            VerticalOptions="Center"
                                            Margin="0,0,8,0"
                                            FontSize="18"
                                            WidthRequest="40"/>
                                </Grid>
                            </Frame>
                        </StackLayout>

                        <!-- Autenticación biométrica mejorada -->
                        <Frame IsVisible="{Binding IsBiometricAvailable}"
                               BackgroundColor="{StaticResource Primary}"
                               BorderColor="Transparent"
                               CornerRadius="12"
                               Padding="16">
                            <Frame.Shadow>
                                <Shadow Brush="{StaticResource Primary}"
                                        Offset="0,2"
                                        Radius="6"
                                        Opacity="0.15"/>
                            </Frame.Shadow>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0" 
                                       Text="🔐" 
                                       FontSize="20" 
                                       VerticalOptions="Center"
                                       TextColor="White"/>

                                <StackLayout Grid.Column="1" 
                                           Margin="12,0,12,0"
                                           VerticalOptions="Center">
                                    <Label Text="Autenticación Biométrica" 
                                           FontSize="15" 
                                           FontAttributes="Bold"
                                           TextColor="White"/>
                                    <Label Text="Acceso rápido y seguro con huella o Face ID" 
                                           FontSize="12" 
                                           TextColor="White"
                                           Opacity="0.9"/>
                                </StackLayout>

                                <Switch Grid.Column="2"
                                        IsToggled="{Binding EnableBiometric}"
                                        OnColor="White"
                                        ThumbColor="{StaticResource Primary}"
                                        VerticalOptions="Center"/>
                            </Grid>
                        </Frame>

                        <!-- Info de contraseña -->
                        <Frame BackgroundColor="{StaticResource Secondary}"
                               CornerRadius="12"
                               Padding="12"
                               Opacity="1">
                            <Label Text="💡 La contraseña debe tener al menos 6 caracteres e incluir letras y números para mayor seguridad" 
                                   FontSize="13" 
                                   TextColor="White"
                                   HorizontalTextAlignment="Center"/>
                        </Frame>
                    </StackLayout>
                </Frame>

                <!-- Mensajes de estado -->
                <StackLayout Spacing="12">
                    <!-- Error message con mejor diseño -->
                    <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                           BackgroundColor="{StaticResource Error}"
                           BorderColor="Transparent"
                           CornerRadius="12"
                           Padding="16"
                           Opacity="1">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="⚠️" 
                                   FontSize="16" 
                                   VerticalOptions="Center"
                                   TextColor="{StaticResource Error}"/>
                            <Label Text="{Binding ErrorMessage}"
                                   TextColor="Black"
                                   FontSize="14"
                                   
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand"/>
                        </StackLayout>
                    </Frame>

                    <!-- Success message con mejor diseño -->
                    <Frame IsVisible="{Binding SuccessMessage, Converter={StaticResource StringToBoolConverter}}"
                           BackgroundColor="{StaticResource Success}"
                           BorderColor="Transparent"
                           CornerRadius="12"
                           Padding="16"
                           Opacity="0.1">
                        <StackLayout Orientation="Horizontal" Spacing="8">
                            <Label Text="✅" 
                                   FontSize="16" 
                                   VerticalOptions="Center"
                                   TextColor="{StaticResource Success}"/>
                            <Label Text="{Binding SuccessMessage}"
                                   TextColor="{StaticResource Success}"
                                   FontSize="14"
                                   VerticalOptions="Center"
                                   HorizontalOptions="FillAndExpand"/>
                        </StackLayout>
                    </Frame>
                </StackLayout>

                <!-- Botones mejorados -->
                <StackLayout Spacing="16" Margin="0,24,0,0">
                    <Button Text="Crear Mi Cuenta"
                            Command="{Binding CreateUserCommand}"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="{StaticResource TextOnPrimary}"
                            CornerRadius="28"
                            HeightRequest="56"
                            FontSize="18"
                            FontAttributes="Bold">
                        <Button.Shadow>
                            <Shadow Brush="{StaticResource PrimaryBrush}"
                                    Offset="0,6"
                                    Radius="12"
                                    Opacity="0.3"/>
                        </Button.Shadow>
                    </Button>

                    <Button Text="Limpiar Formulario"
                            Command="{Binding ClearFormCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{StaticResource TextSecondary}"
                            BorderColor="{StaticResource Gray300}"
                            BorderWidth="2"
                            CornerRadius="28"
                            HeightRequest="48"
                            FontSize="16"
                            />
                </StackLayout>

                <!-- Loading indicator mejorado -->
                <Frame IsVisible="{Binding IsLoading}"
                       BackgroundColor="{StaticResource SurfaceCard}"
                       BorderColor="Transparent"
                       CornerRadius="20"
                       Padding="20"
                       HorizontalOptions="Center">
                    <StackLayout Orientation="Horizontal" Spacing="12">
                        <ActivityIndicator IsVisible="{Binding IsLoading}"
                                           IsRunning="{Binding IsLoading}"
                                           Color="{StaticResource Primary}"
                                           HeightRequest="24"
                                           WidthRequest="24"/>
                        <Label Text="Creando tu cuenta..." 
                               FontSize="16" 
                               TextColor="{StaticResource TextSecondary}"
                               
                               VerticalOptions="Center"/>
                    </StackLayout>
                </Frame>

                <!-- Footer mejorado -->
                <Frame BackgroundColor="Transparent"
                       BorderColor="Transparent"
                       Padding="16"
                       Margin="0,20,0,0">
                    <StackLayout Spacing="8">
                        <Label Text="📋 Los campos marcados con * son obligatorios" 
                               FontSize="13" 
                               TextColor="{StaticResource TextLight}"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>

                        <Label Text="🔐 Al registrarte aceptas nuestros términos y condiciones de uso" 
                               FontSize="13" 
                               TextColor="{StaticResource TextLight}"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>

                        <Label Text="¿Ya tienes cuenta? Inicia sesión" 
                               FontSize="14" 
                               TextColor="{StaticResource Primary}"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               Margin="0,8,0,0"/>
                    </StackLayout>
                </Frame>

            </StackLayout>
        </Grid>
    </ScrollView>
</ContentPage>